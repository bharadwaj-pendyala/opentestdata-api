# Open Test Data API

This is the code that powers the API for [opentestdata.org](https://opentestdata.org), the free and open database of automated test fixture data.

## Under Construction

*This project is very much in early development. Before you submit a PR, talk to us. We might be working on it already.*

## Develop

Tech stack:

* Python
* Flask
* SQLAlchemy

In production, the site runs on Google Cloud services.

### Local development setup

0. Clone the repo, and navigate into it
0. Ensure you have Python 3.7+, Pip, and Pipenv
0. Ensure mysql is installed and running, then run the following script to set up development and test databases
    ```
    mysql -u <USER> -p<PASS> < api/db/init-dev.sql
    ```
0. Run `make dev` to get dependencies set up. (This includes mysql client dependencies, which build native bindings. If you installed mysql/openssl via homebrew, you may need to `export LDFLAGS=-L/usr/local/opt/openssl/lib` before running this to make sure it can find openssl.
0. Run `make migrate-init` to initialize the migrations db

Anytime you check out new code, you should:

0. re-run `make dev`
0. re-run `make migrate` to make sure your db is upgraded with any new schemas

### Run a dev server

### Dev tasks

|Command|Action|
|-------|------|
|`make dev`|Install dev deps|
|`make reqs`|Generate requirements files from pipenv, for use with e.g. appengine|
|`make serve`|Run the development server on the default port of 5000|
|`make migrate-init`|Initialize the database migration tables|
|`make migrate-new`|Create a new migration file to review and commit|
|`make migrate`|Update the database based on all the current migration files|
|`make migrate-history`|Show the migration history|


```
pipenv run flask run
```

## Production

You won't have access to production services, but for those few who do:

* In production, we run on Google AppEngine, in a Flask-like environment. Assume you have the [gcloud](https://cloud.google.com/sdk/docs/quickstart-macos) client ready.
* `app.yaml` defines the AppEngine config

### Production tasks

|Command|Action|
|-------|------|
|`make deploy`|Deploy the app to AppEngine. Requires the `OTD_PROJECT_ID` env var to be set correctly|
