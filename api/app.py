from flask import Flask, request, abort
from .config import get_config
from .db import db, migrate
from .db.models.user import User
import connexion

API_VER = '/v1'


def create_app():

    connexionApp = connexion.FlaskApp(__name__, specification_dir='openapi/')
    app = connexionApp.app
    connexionApp.add_api('api.yaml')
    app.config.from_object(get_config())
    db.init_app(app)
    migrate.init_app(app, db, directory='api/db/migrations')
    return app

def ping():
    return 'PONG'

def signup(username, email, password):
    # TODO check if user details already exist
    user = User(username=username, email=email)
    user.set_password(password)
    db.session.add(user)
    db.session.commit()
    return user
