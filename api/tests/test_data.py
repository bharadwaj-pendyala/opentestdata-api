import pytest
from datetime import datetime
from ..db.models import Datum

DATUM_STREET_NO = dict(
    name='US Address Street Number',
    type='NUM',
    mode='NEUTRAL',
    datum='1126',
)


def test_can_create_datum(client, user):
    assert len(user.data) == 0
    resp = client.post('/data', headers=user.auth_headers,
                       json=DATUM_STREET_NO)
    resp_data = dict(
        **DATUM_STREET_NO,
        user_id=user.id
    )
    assert 'created_at' in resp
    assert 'id' in resp
    del resp['created_at']
    del resp['id']
    assert resp == resp_data
    assert len(user.data) == 1


def test_create_datum_requires_login(client):
    resp = client.post('/data', json=DATUM_STREET_NO, raw=True).get_json()
    assert resp['status'] == 401
    assert 'authorization' in resp['detail']


@pytest.mark.skip(reason="TODO")
def test_cant_create_datum_without_required_fields():
    pass


@pytest.mark.skip(reason="TODO")
def test_cant_create_datum_with_bad_input():
    pass
